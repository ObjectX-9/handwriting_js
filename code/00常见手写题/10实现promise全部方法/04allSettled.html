<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        Promise.allSettled = function (promises) {
            // 参数校验，如果参数不是数组，则抛出错误
            if (!Array.isArray(promises)) {
                throw new Error('promises must be an array')
            }

            return new Promise((resolve, reject) => {
                const result = []

                if (promises.length === 0) {
                    return resolve([])
                }

                promises.forEach(promise => {
                    Promise.resolve(promise).then(value => {
                        result.push({
                            status: 'fulfilled',
                            value: value
                        })
                        if (result.length === promises.length) {
                            resolve(result)
                        }
                    }).catch(reason => {
                        result.push({
                            status: 'rejected',
                            reason: reason
                        })
                        if (result.length === promises.length) {
                            resolve(result)
                        }
                    })
                })

                resolve(result)
            })
        }

        // 帮我写一些测试用例，测试Promise.allSettled
        console.log(Promise.allSettled([new Promise((resolve, reject) => {
            resolve('success')
        })]))
        console.log(Promise.allSettled([new Promise((resolve, reject) => {
            reject('error')
        })]))
        console.log(Promise.allSettled([new Promise((resolve, reject) => {
            resolve('success')
        }), new Promise((resolve, reject) => {
            reject('error')
        })]))

        Promise.allSettled([1, 2, 3]).then(console.log);
        // [{status: 'fulfilled', value: 1}, {status: 'fulfilled', value: 2}, {status: 'fulfilled', value: 3}]

        Promise.allSettled([Promise.resolve(1), 2, Promise.resolve(3)])
            .then(console.log);
        // [{status: 'fulfilled', value: 1}, {status: 'fulfilled', value: 2}, {status: 'fulfilled', value: 3}]

        Promise.allSettled([Promise.resolve(1), Promise.reject('error'), Promise.resolve(3)])
            .then(console.log)
            .catch(console.error);
        // [{status: 'fulfilled', value: 1}, {status: 'rejected', reason: 'error'}, {status: 'fulfilled', value: 3}]

    </script>
</body>

</html>